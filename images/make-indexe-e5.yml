services:
  index-treccovid-1-e5:
    build: ./index-ir_datasets-E5/
    volumes:
      - ../data:/data
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    command: ["--dataset_name=cord19/trec-covid/round1", "--save=1000"]


  index-treccovid-2-e5:
    build: ./index-ir_datasets-E5/
    volumes:
      - ../data:/data
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    command: ["--dataset_name=cord19/trec-covid/round2", "--save=1000"]
    depends_on:   
      index-treccovid-1-e5:
        condition: service_completed_successfully


  index-treccovid-3-e5:
    build: ./index-ir_datasets-E5/
    volumes:
      - ../data:/data
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    command: ["--dataset_name=cord19/trec-covid/round3", "--save=1000"]
    depends_on:   
      index-treccovid-2-e5:
        condition: service_completed_successfully


  index-treccovid-4-e5:
    build: ./index-ir_datasets-E5/
    volumes:
      - ../data:/data
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    command: ["--dataset_name=cord19/trec-covid/round4", "--save=1000"]
    depends_on:   
      index-treccovid-3-e5:
        condition: service_completed_successfully



  index-treccovid-5-e5:
    build: ./index-ir_datasets-E5/
    volumes:
      - ../data:/data
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    command: ["--dataset_name=cord19/trec-covid/round5", "--save=1000"]
    depends_on:   
      index-treccovid-4-e5:
        condition: service_completed_successfully


  # LongEval
  index-longeval-wt-e5:
    build: ./index-longeval-E5/
    volumes:
      - ../data:/data
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    command: ["--dataset_name=longeval-WT", "--save=1000"]
    depends_on:   
      index-longeval-wt-e5:
        condition: service_completed_successfully


  index-longeval-st-e5:
    build: ./index-longeval-E5/
    volumes:
      - ../data:/data
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    command: ["--dataset_name=longeval-ST", "--save=1000"]
    depends_on:   
      index-longeval-wt-e5:
        condition: service_completed_successfully


  index-longeval-lt-e5:
    build: ./index-longeval-E5/
    volumes:
      - ../data:/data
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    command: ["--dataset_name=longeval-LT", "--save=1000"]
    depends_on:   
      index-longeval-st-e5:
        condition: service_completed_successfully


  # TripClick
  index-tripclick-t1-e5:
    build: ./index-tripclick-E5/
    volumes:
      - ../data:/data
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    command: ["--dataset_name=tripclick/test/head-t1", "--save=1000", "--batch_size=150"]
    depends_on:   
      index-longeval-wt-e5:
        condition: service_completed_successfully


  index-tripclick-t2-e5:
    build: ./index-tripclick-E5/
    volumes:
      - ../data:/data
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    command: ["--dataset_name=tripclick/test/head-t2", "--save=1000", "--batch_size=150"]
    depends_on:   
      index-tripclick-t1-e5:
        condition: service_completed_successfully


  index-tripclick-t3-e5:
    build: ./index-tripclick-E5/
    volumes:
      - ../data:/data
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: 1
              capabilities: [gpu]
    command: ["--dataset_name=tripclick/test/head-t3", "--save=1000", "--batch_size=150"]
    depends_on:   
      index-tripclick-t2-e5:
        condition: service_completed_successfully